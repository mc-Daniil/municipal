# human reverse | Hard | Reverse

## Информация

Товарищ! Валерия Николаевна сконструировала робота-женщину-ревёрсера, которая поможет разревёрсить Bombombini Gusini. Она отправила тебе помощницу вместе с инструкцией. К сожалению, инструкция потерялась, а ревёрсить надо. А без активации не получится. Придётся тебе разревёсить и активировать помощницу. Для активации нужно отправить какие-то команды. Разберись, какие и в каком формате.

Вам помогут: Ghidra

Формат флага - "NMARK{}"


## Выдать участинкам

[human](public/human)

## Описание

Читает из переменной окружения флаг и проверяет в 4 этапа. 

## Решение

[Исходный код](src/human.c)

1. Читает флаг из переменной окружения `HUMAN_COMMAND`
2. Проверяет, что длина флага равна 27
3. Узнаёт адрес `{`. Затем считает длину содержимого от начала до `{`. Затем выделяет память и копирует содержимое до `{` в отдельное место. Это содержимое - пароль.
4. Передаёт пароль в `brain()`. Так как состояние изначально 0, то, чтобы его изменить, надо попасть в `unlock()`. Для этого длина пароля должна быть равна 5. Если всё так, вызывается `unlock()`, которая проверяет, что пароль - `NMARK`. Состояние меняется на 1.
5. Если состояние поменялось, продолжаем. Вычисляем адрес `}`. Считаем длину содержимого между фигурными скобками - это набор команд, разделённых запятыми. Выделяем память и копируем их в отдельное место.
6. Далее функция `strtok()` ставит `\0` вместо первой запятой и возвращает указатель на начало первой команды. Удаляются пробелы в начале и в конце. Команда копируется в массив words[].
7. Аналогичные операции со второй и третьей командой.
8. Проверяем, что команд 3
9. Выводим эти три команды
10. Передаём каждую команду в `brain()`. Каждая должна изменить состояние на 1
11. Когда передали первую команду, состояние - 1. Значит, её длина должна быть 5 символов. Тогда вызывается `hand()`, которая проверяет, что команда - `HaNd3`, и меняет состояние на 2
12. Для состояния 2 длина команды должна быть 4. Тогда вызывается функция `leg()`. Функция `leg()` проверяет, что команда - `LeG4`, но сравнивает нулевой символ полученной команды с последним символом строки `4GeL`. Затем - первый и предпоследний символ соответственно и тд. Если всё хорошо, меняет состояние на 3.
13. Для 3 состояние длина должна быть 9. Тогда вызывается функция `stomach()`, которая проверяет, что команда - `StOMAcH52`. Сначала функция проверяет чётные символы. Затем проверяет нечётные символы.
14. Объединив результаты, получаем флаг
15. Можно себя проверить. Чтобы установить переменную окружения, делаем `export HUMAN_COMMAND="NMARK{HaNd3,LeG4,StOMAcH52}"`, затем `./human`


## Флаг

`NMARK{HaNd3,LeG4,StOMAcH52}`

